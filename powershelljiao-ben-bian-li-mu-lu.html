<!DOCTYPE html>
<html lang="en">
<head>
        <title>Frey's blog : powershell脚本遍历目录</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="https://www.vhcffh.com/theme/css/main.css" type="text/css" />
        <link href="https://www.vhcffh.com/" type="application/atom+xml" rel="alternate" title="Frey's blog ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://www.vhcffh.com/css/ie.css"/>
                <script src="https://www.vhcffh.com/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://www.vhcffh.com/css/ie6.css"/><![endif]-->

</head>

<body>
        
<header>
    <h1><a href="https://www.vhcffh.com/powershelljiao-ben-bian-li-mu-lu.html" id="page-title">powershell脚本遍历目录</a></h1>
    <span id="sitename"><a href="https://www.vhcffh.com" id="site-title">Frey's blog </a> &sdot;</span>
<time datetime="2017-09-01T10:01:00+08:00">2017-09-01</time></header>
<article>
    <h1>1.遍历目录及子目录,显示目录大小</h1>
<div class="highlight"><pre><span></span><span class="k">function</span> filesize <span class="o">([</span>string<span class="o">]</span><span class="nv">$filepath</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="nv">$filepath</span> -eq <span class="nv">$null</span><span class="o">)</span> <span class="o">{</span>
        throw <span class="s2">&quot;路径不能为空&quot;</span>
    <span class="o">}</span>
    dir -Path <span class="nv">$filepath</span> <span class="p">|</span> ForEach-Object -Process <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="nv">$_</span>.psiscontainer -eq <span class="nv">$true</span><span class="o">)</span> <span class="o">{</span>
            <span class="nv">$length</span> <span class="o">=</span> <span class="m">0</span>
            dir -Path <span class="nv">$_</span>.fullname -Recurse <span class="p">|</span> ForEach-Object <span class="o">{</span>
                <span class="nv">$length</span> +<span class="o">=</span> <span class="nv">$_</span>.Length
            <span class="o">}</span>
            <span class="nv">$l</span> <span class="o">=</span> <span class="nv">$length</span> / 1KB
            <span class="nv">$_</span>.name + <span class="s2">&quot;文件夹的大小为: {0:n1} KB&quot;</span> -f <span class="nv">$l</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
filesize -filepath <span class="s2">&quot;D:\&quot;</span>
</pre></div>


<h1>2.运行示例:</h1>
<div class="highlight"><pre><span></span>PS F:\python&gt; function filesize ([string]$filepath) {
&gt;&gt; if ($filepath -eq $null) {
&gt;&gt; throw &quot;路径不能为空&quot;
&gt;&gt; }
&gt;&gt; dir -Path $filepath | ForEach-Object -Process {
&gt;&gt; if ($_.psiscontainer -eq $true) {
&gt;&gt; $length = 0
&gt;&gt; dir -Path $_.fullname -Recurse | ForEach-Object {
&gt;&gt; $length += $_.Length
&gt;&gt; }
&gt;&gt; $l = $length / 1KB
&gt;&gt; $_.name + &quot;文件夹的大小为: {0:n1} KB&quot; -f $l
&gt;&gt; }
&gt;&gt; }
&gt;&gt; }
PS F:\python&gt; filesize -filepath &quot;f:\python&quot;
ipluyou文件夹的大小为: 82,196.5 KB
loginip_jlu文件夹的大小为: 16.8 KB
嗅事百科文件夹的大小为: 4.3 KB
小说文件夹的大小为: 31,043.6 KB
笑料文件夹的大小为: 1,578,575.8 KB
PS F:\python&gt;
</pre></div>
</article>

</body>
</html>