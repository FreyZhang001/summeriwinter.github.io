<!DOCTYPE html>
<html lang="en">
<head>
        <title>Frey's blog : socket网络编程</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="https://www.vhcffh.com/theme/css/main.css" type="text/css" />
        <link href="https://www.vhcffh.com/" type="application/atom+xml" rel="alternate" title="Frey's blog ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://www.vhcffh.com/css/ie.css"/>
                <script src="https://www.vhcffh.com/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://www.vhcffh.com/css/ie6.css"/><![endif]-->

</head>

<body>
        
<header>
    <h1><a href="https://www.vhcffh.com/socketwang-luo-bian-cheng.html" id="page-title">socket网络编程</a></h1>
    <span id="sitename"><a href="https://www.vhcffh.com" id="site-title">Frey's blog </a> &sdot;</span>
<time datetime="2018-10-18T10:01:00+08:00">2018-10-18</time></header>
<article>
    <h1>socket网络编程</h1>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">inet_aton</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">cp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">in_addr</span> <span class="o">*</span><span class="n">inp</span><span class="p">);</span>
</pre></div>


<p>转换网络主机地址为二进制数值并存储与第二个参数中
函数返回0表示主机地址无效，非0表示主机地址有效
转化完后需要调用htons或htonl函数才能将主机字节序转换为网络字节序用于网络传输</p>
<div class="highlight"><pre><span></span><span class="kt">char</span> <span class="o">*</span><span class="nf">inet_ntoa</span><span class="p">(</span><span class="k">struct</span> <span class="n">in_addr</span> <span class="n">in</span><span class="p">);</span>
</pre></div>


<p>转换网络字节序为标准的ASCII以点分开的地址，函数返回字符串指针
该字符串空间为静态分配，第二次调用时会覆盖第一次的内容</p>
<div class="highlight"><pre><span></span><span class="n">in_addr_t</span> <span class="nf">inet_addr</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">cp</span><span class="p">);</span>
</pre></div>


<p>转换网络主机地址为网络字节序二进制值
参数无效，返回-1(INADDR_NONE)
注意：转换255.255.255.255时也返回-1</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">inet_pton</span><span class="p">(</span><span class="kt">int</span> <span class="n">af</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dst</span><span class="p">);</span>
</pre></div>


<p>转换字符串到网络地址，af是地址簇，<em>src是来源地址，</em> dst接收转换后的数据。</p>
<div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">inet_ntop</span><span class="p">(</span><span class="kt">int</span> <span class="n">af</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="kt">socklen_t</span> <span class="n">cnt</span><span class="p">);</span>
</pre></div>


<p>转换网络字节序二进制值到ASCII类型的地址，参数的作用和inet_pton相同，
socklen_t cnt指所指向缓存区dst的大小，避免溢出，如果缓存区太小无法存储地址的值，则返回一个空指针，并将errno置为ENOSPC。</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">select</span><span class="p">(</span><span class="kt">int</span> <span class="n">maxfdp</span><span class="p">,</span><span class="n">fd_set</span> <span class="o">*</span><span class="n">readfds</span><span class="p">,</span><span class="n">fd_set</span> <span class="o">*</span><span class="n">writefds</span><span class="p">,</span><span class="n">fd_set</span> <span class="o">*</span><span class="n">errorfds</span><span class="p">,</span><span class="k">struct</span> <span class="n">timeval</span><span class="o">*</span><span class="n">timeout</span><span class="p">);</span>
</pre></div>


<p>int maxfdp 指集合中所有文件描述符的范围，即所有文件描述符的最大值加1，不能错！在Windows中这个参数的值无所谓，可以设置不正确。
struct fd_set 可以理解为一个集合，这个集合中存放的是文件描述符(filedescriptor)，即文件句柄。监视这些文件描述符的读变化</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">setsockopt</span><span class="p">(</span><span class="n">SOCKET</span> <span class="n">s</span><span class="p">,</span><span class="kt">int</span> <span class="n">level</span><span class="p">,</span><span class="kt">int</span> <span class="n">optname</span><span class="p">,</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">optval</span><span class="p">,</span><span class="kt">int</span> <span class="n">optlen</span><span class="p">);</span>
</pre></div>


<p>s(套接字): 指向一个打开的套接口描述字
level:(级别)： 指定选项代码的类型。
SOL_SOCKET: 基本套接口
IPPROTO_IP: IPv4套接口
IPPROTO_IPV6: IPv6套接口
IPPROTO_TCP: TCP套接口
optname(选项名)： 选项名称
optval(选项值): 是一个指向变量的指针 类型：整形，套接口结构， 其他结构类型:linger{}, timeval{ }
optlen(选项长度) ：optval 的大小</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">PASCAL</span> <span class="n">FAR</span> <span class="nf">recvfrom</span><span class="p">(</span> <span class="n">SOCKET</span> <span class="n">s</span><span class="p">,</span> <span class="kt">char</span> <span class="n">FAR</span><span class="o">*</span> <span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">,</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="n">FAR</span><span class="o">*</span> <span class="n">from</span><span class="p">,</span> <span class="kt">int</span> <span class="n">FAR</span><span class="o">*</span> <span class="n">fromlen</span><span class="p">);</span>
</pre></div>


<p>s：标识一个已连接套接口的描述字。
buf：接收数据缓冲区。
len：缓冲区长度。
flags：调用操作方式。
from：（可选）指针，指向装有源地址的缓冲区。
fromlen：（可选）指针，指向from缓冲区长度值。</p>
<h1>参考资料</h1>
<p>1.<a href="https://blog.csdn.net/zyy617532750/article/details/58595700">https://blog.csdn.net/zyy617532750/article/details/58595700</a>
2.<a href="https://www.cnblogs.com/zhoudingcocng/p/6209961.html">https://www.cnblogs.com/zhoudingcocng/p/6209961.html</a></p>
</article>

</body>
</html>