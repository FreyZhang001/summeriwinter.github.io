<!DOCTYPE html>
<html lang="en">
<head>
        <title>Frey's blog : JAVA套接字之TCP简单实用</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="https://vhcffh.com/theme/css/main.css" type="text/css" />
        <link href="https://vhcffh.com/" type="application/atom+xml" rel="alternate" title="Frey's blog ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://vhcffh.com/css/ie.css"/>
                <script src="https://vhcffh.com/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://vhcffh.com/css/ie6.css"/><![endif]-->

</head>

<body>
        
<header>
    <h1><a href="https://vhcffh.com/javatao-jie-zi-zhi-tcpjian-dan-shi-yong.html" id="page-title">JAVA套接字之TCP简单实用</a></h1>
    <span id="sitename"><a href="https://vhcffh.com" id="site-title">Frey's blog </a> &sdot;</span>
<time datetime="2017-08-09T10:01:00+08:00">2017-08-09</time></header>
<article>
    <h1>1.单客户端排队与服务器建立连接</h1>
<p><font color="red">客户端程序</font>  </p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.net.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span><span class="o">{</span>
    <span class="kd">static</span> <span class="n">Socket</span> <span class="n">server</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span><span class="kd">throws</span> <span class="n">Exception</span><span class="o">{</span>
        <span class="c1">//客户端请求与本机在5678端口建立TCP连接</span>
        <span class="n">server</span><span class="o">=</span><span class="k">new</span> <span class="n">Socket</span><span class="o">(</span><span class="n">InetAddress</span><span class="o">.</span><span class="na">getLocalHost</span><span class="o">(),</span><span class="mi">5678</span><span class="o">);</span>
        <span class="n">BufferedReader</span> <span class="n">in</span><span class="o">=</span>
            <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">server</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
        <span class="c1">//获取Socket的输入流，用来接收从服务端发送过来的数据</span>
        <span class="n">PrintWriter</span> <span class="n">out</span><span class="o">=</span><span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="n">server</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>
        <span class="c1">//获取Socket的输出流，用来发送数据到服务端</span>
        <span class="n">BufferedReader</span> <span class="n">wt</span><span class="o">=</span><span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">));</span>
        <span class="c1">//从键盘输入的数据流</span>
        <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">str</span><span class="o">=</span><span class="n">wt</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span><span class="c1">//读取键盘输入字符串</span>
            <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">);</span><span class="c1">//发送数据到服务端</span>
            <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
            <span class="k">if</span><span class="o">(</span><span class="n">str</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;end&quot;</span><span class="o">)){</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">());</span><span class="c1">//打印服务器返回的字符串</span>
        <span class="o">}</span>
        <span class="n">server</span><span class="o">.</span><span class="na">close</span><span class="o">();</span><span class="c1">//关闭连接</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p><font color="blue">服务器程序1</font></p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Server</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
        <span class="n">ServerSocket</span> <span class="n">server</span><span class="o">=</span><span class="k">new</span> <span class="n">ServerSocket</span><span class="o">(</span><span class="mi">5678</span><span class="o">);</span><span class="c1">//通信端口</span>
        <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">){</span><span class="c1">//一个客户端断开连接后，等待与另一个客户端建立连接</span>
            <span class="n">Socket</span> <span class="n">client</span><span class="o">=</span><span class="n">server</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span><span class="c1">//accept用于产生&quot;阻塞&quot;，直到接受到一个连接，并且返回一个客户端的Socket对象实例。</span>
            <span class="n">BufferedReader</span> <span class="n">in</span><span class="o">=</span>
                <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">client</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
            <span class="n">PrintWriter</span> <span class="n">out</span><span class="o">=</span><span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="n">client</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>
            <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">){</span><span class="c1">//直到客户端发送end退出循环</span>
                <span class="n">String</span> <span class="n">str</span><span class="o">=</span><span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
                <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;has receive....&quot;</span><span class="o">);</span>
                <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
                <span class="k">if</span><span class="o">(</span><span class="n">str</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;end&quot;</span><span class="o">))</span>
                    <span class="k">break</span><span class="o">;</span>   
            <span class="o">}</span>   
            <span class="n">client</span><span class="o">.</span><span class="na">close</span><span class="o">();</span><span class="c1">//关闭通信</span>
        <span class="o">}</span>
    <span class="o">}</span>   
<span class="o">}</span>
</pre></div>


<h1>2.多个客户端同时与服务器建立连接</h1>
<p>客户端程序不变,服务器端阻塞等待客户端连接,并给每个链接分配一个线程<br>
<font color="blue">服务器程序2</font></p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Server</span> <span class="kd">extends</span> <span class="n">Thread</span> <span class="o">{</span><span class="c1">//继承Thread类</span>
    <span class="kd">private</span> <span class="n">Socket</span> <span class="n">client</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Server</span><span class="o">(</span><span class="n">Socket</span> <span class="n">c</span><span class="o">){</span><span class="c1">//类初始化，接受参数为客户端的请求</span>
        <span class="k">this</span><span class="o">.</span><span class="na">client</span> <span class="o">=</span> <span class="n">c</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span><span class="c1">//重写run函数</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="n">BufferedReader</span> <span class="n">in</span><span class="o">=</span>
                <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">client</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
            <span class="n">PrintWriter</span> <span class="n">out</span><span class="o">=</span><span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="n">client</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>
            <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">){</span>
                <span class="n">String</span> <span class="n">str</span><span class="o">=</span><span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
                <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;has receive....&quot;</span><span class="o">);</span>
                <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
                <span class="k">if</span><span class="o">(</span><span class="n">str</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;end&quot;</span><span class="o">))</span>
                    <span class="k">break</span><span class="o">;</span>   
            <span class="o">}</span>   
            <span class="n">client</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">){</span>
        <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
        <span class="n">ServerSocket</span> <span class="n">server</span><span class="o">=</span><span class="k">new</span> <span class="n">ServerSocket</span><span class="o">(</span><span class="mi">5678</span><span class="o">);</span>
        <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">){</span>
            <span class="n">Server</span> <span class="n">mu</span><span class="o">=</span><span class="k">new</span> <span class="n">Server</span><span class="o">(</span><span class="n">server</span><span class="o">.</span><span class="na">accept</span><span class="o">());</span><span class="c1">//每当有客户端请求就新建一个Server类与之通信</span>
            <span class="n">mu</span><span class="o">.</span><span class="na">start</span><span class="o">();</span><span class="c1">//启动进程</span>
        <span class="o">}</span>
    <span class="o">}</span>   
<span class="o">}</span>
</pre></div>
</article>

</body>
</html>