<!DOCTYPE html>
<html lang="en">
<head>
        <title>Frey's blog : 图片头文件解析</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="https://vhcffh.com/theme/css/main.css" type="text/css" />
        <link href="https://vhcffh.com/" type="application/atom+xml" rel="alternate" title="Frey's blog ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://vhcffh.com/css/ie.css"/>
                <script src="https://vhcffh.com/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://vhcffh.com/css/ie6.css"/><![endif]-->

</head>

<body>
        
<header>
    <h1><a href="https://vhcffh.com/tu-pian-tou-wen-jian-jie-xi.html" id="page-title">图片头文件解析</a></h1>
    <span id="sitename"><a href="https://vhcffh.com" id="site-title">Frey's blog </a> &sdot;</span>
<time datetime="2017-12-12T10:01:00+08:00">2017-12-12</time></header>
<article>
    <h1>1.PNG图片文件头</h1>
<h2>1.1PNG文件结构</h2>
<p>PNG图像格式文件由一个8字节的PNG文件标识（file signature）域和3个以上的后续数据块（IHDR、IDAT、IEND等）组成。<br>
PNG文件包括8字节文件署名（89 50 4E 47 0D 0A 1A 0A，十六进制），用来识别PNG格式。  </p>
<table>
<thead>
<tr>
<th align="center">十六进制</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">89</td>
<td align="left">用于检测传输系统是否支持8位的字符编码（8 bit data），用以减少将文本文件被错误的识别成PNG文件的机会，反之亦然。</td>
</tr>
<tr>
<td align="center">50 4E 47</td>
<td align="left">PNG每个字母对应的ASCII，让用户可以使用文本编辑器查看时，识别出是PNG文件。</td>
</tr>
<tr>
<td align="center">0D 0A</td>
<td align="left">DOS风格的换行符（CRLF）。用于DOS-Unix数据的换行符转换。</td>
</tr>
<tr>
<td align="center">1A</td>
<td align="left">在DOS命令行下，用于阻止文件显示的文件结束符。</td>
</tr>
<tr>
<td align="center">0A</td>
<td align="left">Unix风格的换行符（LF）。用于Unix-DOS换行符的转换。</td>
</tr>
</tbody>
</table>
<h2>1.2PNG数据块（chunk）</h2>
<p>PNG定义了两种类型的数据块，一种是称为关键数据块(critical chunk)，这是标准的数据块，另一种叫做辅助数据块(ancillary chunks)，这是可选的数据块。<br>
关键数据块定义了4个标准数据块，每个PNG文件都必须包含它们，PNG读写软件也都必须要支持这些数据块。虽然PNG文件规范没有要求PNG编译码器对可选数据块进行编码和译码，但规范提倡支持可选数据块。<br>
下表就是PNG中数据块的类别，其中，关键数据块部分我们使用红色背景加以区分。</p>
<table>
<thead>
<tr>
<th align="center">数据块符号</th>
<th align="center">数据块名称</th>
<th align="center">多数据块</th>
<th align="center">可选否</th>
<th align="center">位置限制</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">IHDR</td>
<td align="center">文件头数据块</td>
<td align="center">否</td>
<td align="center">否</td>
<td align="center">第一块</td>
</tr>
<tr>
<td align="center">cHRM</td>
<td align="center">基色和白色点数据块</td>
<td align="center">否</td>
<td align="center">是</td>
<td align="center">在PLTE和IDAT之前</td>
</tr>
<tr>
<td align="center">gAMA</td>
<td align="center">图像γ数据块</td>
<td align="center">否</td>
<td align="center">是</td>
<td align="center">在PLTE和IDAT之前</td>
</tr>
<tr>
<td align="center">sBIT</td>
<td align="center">样本有效位数据块</td>
<td align="center">否</td>
<td align="center">是</td>
<td align="center">在PLTE和IDAT之前</td>
</tr>
<tr>
<td align="center">PLTE</td>
<td align="center">调色板数据块</td>
<td align="center">否</td>
<td align="center">是</td>
<td align="center">在IDAT之前</td>
</tr>
<tr>
<td align="center">bKGD</td>
<td align="center">背景颜色数据块</td>
<td align="center">否</td>
<td align="center">是</td>
<td align="center">在PLTE之后IDAT之前</td>
</tr>
<tr>
<td align="center">hIST</td>
<td align="center">图像直方图数据块</td>
<td align="center">否</td>
<td align="center">是</td>
<td align="center">在PLTE之后IDAT之前</td>
</tr>
<tr>
<td align="center">tRNS</td>
<td align="center">图像透明数据块</td>
<td align="center">否</td>
<td align="center">是</td>
<td align="center">在PLTE之后IDAT之前</td>
</tr>
<tr>
<td align="center">oFFs</td>
<td align="center">(专用公共数据块)</td>
<td align="center">否</td>
<td align="center">是</td>
<td align="center">在IDAT之前</td>
</tr>
<tr>
<td align="center">pHYs</td>
<td align="center">物理像素尺寸数据块</td>
<td align="center">否</td>
<td align="center">是</td>
<td align="center">在IDAT之前</td>
</tr>
<tr>
<td align="center">sCAL</td>
<td align="center">(专用公共数据块)</td>
<td align="center">否</td>
<td align="center">是</td>
<td align="center">在IDAT之前</td>
</tr>
<tr>
<td align="center">IDAT</td>
<td align="center">图像数据块</td>
<td align="center">是</td>
<td align="center">否</td>
<td align="center">与其他IDAT连续</td>
</tr>
<tr>
<td align="center">tIME</td>
<td align="center">图像最后修改时间数据块</td>
<td align="center">否</td>
<td align="center">是</td>
<td align="center">无限制</td>
</tr>
<tr>
<td align="center">tEXt</td>
<td align="center">文本信息数据块</td>
<td align="center">是</td>
<td align="center">是</td>
<td align="center">无限制</td>
</tr>
<tr>
<td align="center">zTXt</td>
<td align="center">压缩文本数据块</td>
<td align="center">是</td>
<td align="center">是</td>
<td align="center">无限制</td>
</tr>
<tr>
<td align="center">fRAc</td>
<td align="center">(专用公共数据块)</td>
<td align="center">是</td>
<td align="center">是</td>
<td align="center">无限制</td>
</tr>
<tr>
<td align="center">gIFg</td>
<td align="center">(专用公共数据块)</td>
<td align="center">是</td>
<td align="center">是</td>
<td align="center">无限制</td>
</tr>
<tr>
<td align="center">gIFt</td>
<td align="center">(专用公共数据块)</td>
<td align="center">是</td>
<td align="center">是</td>
<td align="center">无限制</td>
</tr>
<tr>
<td align="center">gIFx</td>
<td align="center">(专用公共数据块)</td>
<td align="center">是</td>
<td align="center">是</td>
<td align="center">无限制</td>
</tr>
<tr>
<td align="center">IEND</td>
<td align="center">图像结束数据</td>
<td align="center">否</td>
<td align="center">否</td>
<td align="center">最后一个数据块</td>
</tr>
</tbody>
</table>
</article>

</body>
</html>